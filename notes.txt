1) To find connected users-

select count (*) from gv$session; 

show parameter sessions 



2) to find wait events
col username for a20; 

col progra for a30; 

col machine for a30; 

col event for a40; 

col osuser for a20; 

select a.sid,substr(b.username,1,10) username,substr(b.osuser,1,10) osuser,  

substr(b.program||b.module,1,15) program,substr(b.machine,1,22) machine,  

a.event,a.p1,b.sql_hash_value  

from v$session_wait a,V$session b  

where b.sid=a.sid  

and a.event not in('SQL*Net message from client','SQL*Net message to client',  

'smon timer','pmon timer')  

and username is not null  

order by 6  

/ 





3)Flash recovery area
You can query the V$RECOVERY_FILE_DEST to identify that location. The flash recovery area should be on a separate disk from the database area, where active database files such as datafiles, control files, and online redo logs are stored. a single, centralized, unified storage area that keep all the database backup & recovery related files and performs those activities in Oracle databases.


select name,floor(space_limit / 1024 / 1024 /1024) "Size GB",ceil(space_used / 1024 / 1024 /1024) "Used GB"from v$recovery_file_dest; 
SELECT * FROM V$FLASH_RECOVERY_AREA_USAGE; 
Show parameter recovery 

File system add 20gb using below command 
Alter system set db_recovery_file_dest_size =380g scope =both sid=’*’; 

If ASM then use below query to add more space to FRA 
Alter system set db_recovery_file_dest_size =(current size +100g) scope =both sid=’*’;


4) Query to find pga utilization -- program global area --A memory area used by a single Oracle server process.
SELECT ROUND(SUM(pga_used_mem)/(1024*1024),2) PGA_USED_MB FROM v$process; 
Show parameter pga 

5) to find alert log location: 
show parameter background 11g 
show parameter dump 19c 
tail -500f alert.logfile




6) housekeep
find _path_ -name "_extension of file_" -mtime +1 -ls -exec rm {} \;
find /ORACLE/dbaora01s/diag/rdbms/dws01s/DWS01S/trace -name "*.trm*" -mtime +1 -ls -exec rm {} \;
rm -rf *trc

7) to alter pluggable db
show pdbs;
alter session set container= Pluggabledbname ;
alter session set container=ORA24;


8) To check sync of dataguard
SELECT ARCH.THREAD# "Thread",
ARCH.SEQUENCE# "Last Sequence Received",
APPL.SEQUENCE# "Last Sequence Applied",
(ARCH.SEQUENCE# - APPL.SEQUENCE#) "Difference"
FROM
(SELECT THREAD# ,SEQUENCE# FROM V$ARCHIVED_LOG WHERE (THREAD#,FIRST_TIME ) IN (SELECT THREAD#,MAX(FIRST_TIME) FROM V$ARCHIVED_LOG GROUP BY THREAD#)) ARCH,
(SELECT THREAD# ,SEQUENCE# FROM V$LOG_HISTORY WHERE (THREAD#,FIRST_TIME ) IN (SELECT THREAD#,MAX(FIRST_TIME) FROM V$LOG_HISTORY GROUP BY THREAD#)) APPL WHERE ARCH.THREAD# = APPL.THREAD#;

9) To check tablespace
set feedback off
set verify off
set pagesize 400
set linesize 300
column Tablespace format a25
define level=85
define unit=1073741824
select TABLESPACE_NAME as "Tablespace",round("Size"/'&&unit',0) as "Size",round("Used"/'&&unit',0) as "Used", round(("Size"-"Used")/'&&unit',0) as "Free",
round(("Size"-"Used")*100/"Size",0) as "Percent Free",round("Used" * 100/"Size",0) as "Percent Used", round(100*round("Used"/'&&unit',0)/'&&level',0) as "&&level%",
case when round(100*round("Used"/'&&unit',0)/'&&level',0)-round("Size"/&&unit,0) > 0 then round(100*round("Used"/'&&unit',0)/'&&level',0)-round("Size"/&&unit,0) else 0 end as "Enlargement"
from (
select c.TABLESPACE_NAME, sum(
case when c.AUTOEXTENSIBLE = 'YES' then
case when c.MAXBYTES > c.BYTES then c.MAXBYTES
when c.MAXBYTES <= c.BYTES then c.BYTES
end
else c.BYTES
end) as "Size",
(select a.bytes-(decode(b.bytes,null,0,b.bytes)) from sys.sm$ts_avail a, sys.sm$ts_free b where a.tablespace_name = b.tablespace_name(+) and a.tablespace_name=c.tablespace_name) as "Used"
from dba_data_files c group by c.TABLESPACE_NAME) order by "Percent Used";
--------------------------------------------------------------------------------------------------------------------



select  a.tablespace_name,A.Allocated,nvl(B.used,0) used,A.Allocated-nvl(B.used,0) free_space,round((A.Allocated-nvl
(B.used,0))/a.allocated*100) "% Free"
from
(select tablespace_name ,sum(decode(maxbytes,0,bytes,maxbytes))/1024/1024 Allocated from dba_data_files group by tablespace_name) A,
(select tablespace_name,sum(bytes)/1024/1024 used from dba_segments group by tablespace_name) B
where a.tablespace_name=b.tablespace_name (+)
order by 5;


-----------------------------------------------------------------------------------------------------------------------
to check tablespace,
 
set lines 200;
 
SELECT 
TABLESPACE_SIZE/1024/1024/1024,ALLOCATED_SPACE/1024/1024/1024,FREE_SPACE/1024/1024/1024 
FROM DBA_TEMP_FREE_SPACE;



--- to check datafiles in tablespace
set lines 200
col TABLESPACE_NAME for a15
col FILE_NAME for a50
SELECT TABLESPACE_NAME,FILE_NAME,AUTOEXTENSIBLE,
INCREMENT_BY*8192/1024/1024 "INCREMENT_BY_MB",MAXBYTES/1024/1024/1024 "MAX IN GB",
BYTES/1024/1024/1024 "SIZE_IN_GB"
FROM DBA_DATA_FILES WHERE TABLESPACE_NAME='FOM_PL';

to check size of tablespace
select tablespace_name,file_id,file_name,bytes/1024/1024,maxbytes/1024/1024,autoextensible from dba_data_files where tablespace_name='INFADATA' order by file_name;

to check if it is a bigfile
select name, bigfile from v$tablespace;


11) to check mount point utilization
SELECT name, free_mb, total_mb, free_mb/total_mb*100 as percentage FROM v$asm_diskgroup;

10) to alter tablespace
alter tablespace INFADATA add datafile '+DATA' size 15G autoextend on next 50M MAXSIZE 31774M;


alter tablespace CLM_X add datafile '/ORACLE/SBD12/base/CLM_X26.dbf' size 10G autoextend on MAXSIZE 30G;


alter database datafile '+DATA/FDEP/FOM_DE/fom_de01.dbf' autoextend on maxsize 9700G;

alter database datafile '/ORACLE/ORA10/base/users02.dbf' autoextend on maxsize 30G;
ALTER TABLESPACE ARCHIV ADD DATAFILE 'I:\ORACLE\ORADATA\ARCHIV\ARCHIV_42.DBF' SIZE 14G;
ALTER DATABASE DATAFILE '/u02/oracle/CRMDBP/data/undotbs12.dbf' RESIZE 6G;
alter tablespace FOM_PL add datafile '+DATA01/FOMP/fom_pl03.dbf' size 2G autoextend on MAXSIZE 30G;
alter database datafile '+FRA/rdbdev/datafile/undotbs1.7228.1150136681' resize 25G;
alter tablespace UNDOTBS add datafile '/u02/oracle/CRMDBP/data/undotbs14.dbf' size 4g;

11) how to stop and ASM 
stop database-
sudo su - oracle
shut immediate;

stop listener
lsnrctl stop LISTENER

then stop asm
sudo su - grid
. oraenv
ORACLE_SID = [grid] ? +ASM
sqlplus / as sysdba
shut immediate;
exit
crsctl stop has
-----------------
start database-
sudo su - oracle
startup

start listener
lsnrctl start LISTENER

start asm
sudo su - grid
. oraenv
ORACLE_SID = [grid] ? +ASM
crsctl start has


12) if asm doestn't start
sudo su - root

. oraenv
+ASM

crsctl stop has -f

oracleasm init
oracleasm scandisks
oracleasm listdisks

crsctl start has

ps -ef | grep pmon


13) to check waiters and blockers
select * from dba_waiters;
select * from dba_blockers;

14) rman backup
cd /ORACLE/export0/RMAN_LOGS (first check rman logs)
ls -lrt
cd dbname (go to the db for which backup is failed)
ls -lrt
cd logs (go to logs)
ls -lrt
tail -200f rman____.log (check latest log)
crontab -l (if rman log shows and error msg in the end go to crontab)
cat /home/oracle/RMAN_BKP/..../rman____ARCH.sh
rman target / catalog rman_ibm2P/mADN3zW8@RMANCAT3 (you will get this in output of cat command)
crosscheck archivelog all; (crosscheck the archive logs)
exit
crontab -l
sh /home/oracle/RMAN_BKP/TESTDB/rman_TESTDB_ARCH.sh (run the backup it will take some time)
sqlplus / as sysdba --- (now login to database and check whether backup is completed or not)

Backup query-
set line 200 pages 300
col TIME_TAKEN_DISPLAY for a10
select SESSION_KEY, INPUT_TYPE, STATUS,
to_char(START_TIME,'dd-mm-yyyy:hh24:mi:ss') start_time,
to_char(END_TIME,'dd-mm-yyyy:hh24:mi:ss') end_time,
time_taken_display,OUTPUT_BYTES/1024/1024/1024 "size in GB"
from V$RMAN_BACKUP_JOB_DETAILS
order by session_key ;



--------------------------------------------------------------------------
to check backup logs
oracle@bms04dbaxp05p ~]$ cd /nsr/apps/logs
[oracle@bms04dbaxp05p logs]$ ls -lrt
total 1160
-rw-r--r-- 1 root   root          0 Jan 23 12:56 nsrdb2ra.log
-rw-r--r-- 1 root   root          0 Jan 23 12:56 nsrifmxra.log
-rw-r--r-- 1 root   root          0 Jan 23 12:56 nsrlotra.log
-rw-r--r-- 1 root   root          0 Jan 23 12:56 nsrmysqlra.log
-rw-r--r-- 1 root   root          0 Jan 23 12:56 nsrorara.log
-rw-r--r-- 1 root   root          0 Jan 23 12:56 nsrsybra.log
-rw-r--r-- 1 oracle oinstall   8766 Mar  7 14:28 msglog_full_XPAYDB.log
-rw-r--r-- 1 oracle oinstall  35025 Mar 11 04:02 msglog_incr_XPAYDB.log
-rw-r--r-- 1 oracle asmadmin 473516 Mar 11 08:16 nmda_oracle.messages.raw
-rw-r--r-- 1 oracle oinstall 662936 Mar 11 08:16 msglog_archive_XPAYDB.log
[oracle@bms04dbaxp05p logs]$ tail -1000f msglog_full_XPAYDB.log
 
tail -100f msglog_full_XPAYDB.log
----------------------------------------------------------------------------

col name for a10
col open_mode for a15
col database_role for a10
select name,open_mode,database_role from v$database;

15) to check diskgroup utilization
set lines 200;
Select NAME, round ((TOTAL_MB/1024), 2) Total_GB,
round ((FREE_MB/1024),2) Free_GB,
round((TOTAL_MB/1024),2) - round((FREE_MB/1024),2) Used_GB,
round(((free_mb/total_mb)*100),2) "FREE% ",
round((((total_mb-free_mb)/total_mb)*100),2) "USED%"
from v$asm_diskgroup;

16) move log files to offshore
sudo su - oracle
cd /applications/oracle/db_share/Offshore/ (go to offshore path)
$ mkdir dbname_log_date (create a directory for logfile) 
$ cd dbname_log_date (go into the directory)
$ pwd
/applications/oracle/db_share/Offshore/dbname_log_date (copy the path)
cd /applications/oracle (now go to the path where log files are present)
mv log_*.xml /applications/oracle/db_share/Offshore/dbname_log_date (mv command will move the files to mentioned path)

17) To housekeep diskgroup
--first check db is standby or primary
select name,open_mode, database_role from v$database;
show parameter config;
--to check max sequence
select max(sequence#) from v$log_history;


-- to check log gap between thread sequence
set line 180
break on  dest_id skip 1
set pagesize 50
select a.thread#,b.dest_id,a.log_archived,b.log_applied,(a.log_archived-b.log_applied) log_gap
from
(
select thread#,max(sequence#)log_archived from gv$archived_log where archived='YES' and dest_id=1 and resetlogs_time=(select max(resetlogs_time) from gv$archived_log) group by thread#
)a,
(
select thread#,dest_id,max(sequence#)log_applied from gv$archived_log where applied='YES' and dest_id >1 and resetlogs_time=(select max(resetlogs_time) from gv$archived_log) group by dest_id,thread# order by 2
)b
where a.thread#=b.thread# order by 2,1;

-- to check diskgroup utilization
set lines 200;
Select NAME, round ((TOTAL_MB/1024), 2) Total_GB,
round ((FREE_MB/1024),2) Free_GB,
round((TOTAL_MB/1024),2) - round((FREE_MB/1024),2) Used_GB,
round(((free_mb/total_mb)*100),2) "FREE% ",
round((((total_mb-free_mb)/total_mb)*100),2) "USED%"
from v$asm_diskgroup;

--check backup 
set line 200 pages 300
col TIME_TAKEN_DISPLAY for a10
select SESSION_KEY, INPUT_TYPE, STATUS,
to_char(START_TIME,'dd-mm-yyyy:hh24:mi:ss') start_time,
to_char(END_TIME,'dd-mm-yyyy:hh24:mi:ss') end_time,
time_taken_display,OUTPUT_BYTES/1024/1024/1024 "size in GB"
from V$RMAN_BACKUP_JOB_DETAILS
order by session_key ;

If everything is ok and L3 confirmed you can delete the thread sequence
sudo su - grid
ps -ef|grep pmon
login to as +ASM --  . oraenv
asmcmd
cd diskgroup
ls 
cd archive log
remove archive thread sequence


18) to start stop oms agent
export ORACLE_HOME=/applications/oracle/oms13R4/Middleware
cd /applications/oracle/oms13R4/Middleware/bin
./emctl status oms
./emctl stop oms
./emctl start oms


19) to check session status
select count(1),status from v$session group by status;

To Check the version of database-
SELECT BANNER, BANNER_FULL FROM v$version;


20) to check deatils of failed job
select OWNER,JOB_NAME,STATUS,LOG_DATE from DBA_SCHEDULER_JOB_RUN_DETAILS where status ='FAILED';

SELECT OWNER, JOB_NAME, JOB_ACTION, JOB_STYLE, STATE, JOB_CREATOR, LAST_START_DATE, LAST_RUN_DURATION, NEXT_RUN_DATE FROM DBA_SCHEDULER_JOBS where job_name='ORA$AT_SA_SPC_SY_1052';


21) to restamp password
select USERNAME,ACCOUNT_STATUS,LOCK_DATE,EXPIRY_DATE,CREATED,LAST_LOGIN, GRANTEE, PROFILE from dba_users where USERNAME='';
ALTER USER  PROFILE C##SOX;
ALTER USER  PROFILE default;
alter user tivoli identified by tivoli;


22) to drop tables in a tablespace
select owner,segment_name from dba_segments where segment_name in ('WC_CNSMR_PROD_CAT_DH_0206');
DROP TABLE BI_EDWH.WC_OADCV_MONTH_FS_06062023;


23) to change password
select name,open_mode from v$database;
select USERNAME,ACCOUNT_STATUS,LOCK_DATE,EXPIRY_DATE,CREATED,PROFILE from dba_users where USERNAME='SQL_PRO_SGHOSH';
alter user SQL_PRO_SGHOSH  IDENTIFIED by Welc0me#852 account unlock;
select USERNAME,CREATED,LAST_LOGIN,ACCOUNT_STATUS,LOCK_DATE,EXPIRY_DATE,PROFILE from dba_users where USERNAME IN ('', '','','',''); -- to check multiple users together


24) to alter schema
alter session set current_schema=ORA24;


25) to check recovery area
set line 200
select file_type, percent_space_used, percent_space_reclaimable, number_of_files from v$recovery_area_usage order by 1;

This will report the percentage of memory in use
% free | grep Mem | awk '{print $3/$2 * 100.0}'
23.8171
This will report the percentage of memory that's free
% free | grep Mem | awk '{print $4/$2 * 100.0}'
76.5013

26) to check blocking session
select
blocking_session,
sid,
serial#,
wait_class,
seconds_in_wait
from
v$session
where
blocking_session is not NULL
order by
blocking_session;

select a.SID "Blocking Session", b.SID "Blocked Session"
from v$lock a, v$lock b
where a.SID != b.SID and a.ID1 = b.ID1 and a.ID2 = b.ID2 and
b.request > 0 and a.block = 1;

SELECT SID, SERIAL#, STATUS, MACHINE, MODULE, SQL_ID FROM V$SESSION WHERE SID=' 530';

SELECT SQL_FULLTEXT from gv$SQL where SQL_ID='gmhcscntztr2q';

-- to fetch kill query of blocking session
select 'alter system kill session '''||sid||','||serial#||',@'||inst_id||''' immediate;' from gv$session where sid='427';

-- to kill blocking session
alter system kill session '779,22554' immediate;


27) to check long running session
select SID,serial#,SQL_ID,USERNAME,osuser,status from v$session where sql_id='3wy7uyw9tag0p';

-- to fetch kill query of long running session
select 'alter system kill session '''||sid||','||serial#||',@'||inst_id||''' immediate;' from gv$session where sql_id='2bnruuhkqbpmr';



28)  to housekeep fra
rman target /
DELETE force ARCHIVELOG ALL COMPLETED BEFORE 'sysdate-0.2'; 

SELECT name, free_mb, total_mb, free_mb/total_mb*100 as percentage FROM v$asm_diskgroup;


29) activity
Start up:
after server reboot()
ps -ef|grep pmon
ps -ef|grep tns
lsnrctl status LISTENER
lsnrctl start LISTENER
lsnrctl status LISTENER
. oraenv
sqlplus / as sysdba
startup;
select name,open_mode,log_mode,database_role from v$database;


30)
C##SOX_USER = individual/ personal users
C##SOX= system/ service
C##SOX_USER_PRIV = privilaged individual / personal account


31)Jenkins
---DB Blackout ---
 
Open OEM 
Search TAXSUP
Select TAXSUP-- target-----cluster database--- 1st opt
click on cluster database
control
create blackout
Name --- CTAXSUP_(date)
unchecked 1st box
scroll down---schedule---duration---select indefinitely
Submit
 
---Remove Blackout---
 
Cluster database
Control
End blackout
Target---select YES





32)
Relink wali activity ke liye reference
 
---RELINK---
 
6)    Relinking – make sure that DB Listener are down
 
a)    set Database environment and got to cd $ORACLE_HOME/bin
 
b)    pwd
 
c)    ./relink as_installed
 
d)    Once relinking is done
 
e)    Start database
 
f)    Start listener
 
 
 
Dekhna db aur listener down hi hona chaiye
 
Agar activity k baad automatic start ho gya to manually stop karna fir relink




33) O drive housekeeping
rman target sys/xsVf#4VZ6vI#cD0kAs
 
RMAN> connect catalog RMAN_CNF47DB003_HYD1E35/Rman7626@rmp_prd
 
RMAN> delete force archivelog until time 'sysdate-2' like 'O:\ORACLE\ORADATA\HYD1E35\ARCHIVE_2\LOG%';
 
RMAN> crosscheck archivelog all;
 
O:\oracle\oradata\HYD1E35\archive_2\log



34) mmst user status check
to check user status in mmst
 
set pages 200;
set lines 200;
select username,account_status from dba_users;


35) Parameter check
show parameter undo;

show parameter cpu;

show parameter cluster;

show parameter service_name;

show parameter sga;

show parameter listener;

show parameter comp;














